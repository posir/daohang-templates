THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){Ee.setRGB(0,0,0),xe.setRGB(0,0,0),ye.setRGB(0,0,0);for(var e=0,t=R.length;e<t;e++){var i=R[e],n=i.color;i.isAmbientLight?Ee.add(n):i.isDirectionalLight?xe.add(n):i.isPointLight&&ye.add(n)}}function i(e,t,i){for(var n=0,r=R.length;n<r;n++){var o=R[n];if(de.copy(o.color),o.isDirectionalLight){var a=ve.setFromMatrixPosition(o.matrixWorld).normalize(),s=t.dot(a);if(s<=0)continue;s*=o.intensity,i.add(de.multiplyScalar(s))}else if(o.isPointLight){var a=ve.setFromMatrixPosition(o.matrixWorld),s=t.dot(ve.subVectors(a,e).normalize());if(s<=0)continue;if(0==(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1)))continue;s*=o.intensity,i.add(de.multiplyScalar(s))}}}function n(e,t,i){f(i.opacity),h(i.blending);var n=t.scale.x*U,r=t.scale.y*q,o=Math.sqrt(n*n+r*r);if(ue.min.set(e.x-o,e.y-o),ue.max.set(e.x+o,e.y+o),i.isSpriteMaterial){var a=i.map;if(null!==a){var s=fe[a.id];if(s!==undefined&&s.version===a.version||(s=c(a),fe[a.id]=s),s.canvas!==undefined){y(s.canvas);var l=a.image,p=l.width*a.offset.x,d=l.height*a.offset.y,m=l.width*a.repeat.x,u=l.height*a.repeat.y,E=n/m,v=r/u;Z.save(),Z.translate(e.x,e.y),0!==i.rotation&&Z.rotate(i.rotation),Z.translate(-n/2,-r/2),Z.scale(E,v),Z.translate(-p,-d),Z.fillRect(p,d,m,u),Z.restore()}}else y(i.color.getStyle()),Z.save(),Z.translate(e.x,e.y),0!==i.rotation&&Z.rotate(i.rotation),Z.scale(n,-r),Z.fillRect(-.5,-.5,1,1),Z.restore()}else i.isSpriteCanvasMaterial?(x(i.color.getStyle()),y(i.color.getStyle()),Z.save(),Z.translate(e.x,e.y),0!==i.rotation&&Z.rotate(i.rotation),Z.scale(n,r),i.program(Z),Z.restore()):i.isPointsMaterial&&(y(i.color.getStyle()),Z.save(),Z.translate(e.x,e.y),0!==i.rotation&&Z.rotate(i.rotation),Z.scale(n*i.size,-r*i.size),Z.fillRect(-.5,-.5,1,1),Z.restore())}function r(e,t,i,n){if(f(n.opacity),h(n.blending),Z.beginPath(),Z.moveTo(e.positionScreen.x,e.positionScreen.y),Z.lineTo(t.positionScreen.x,t.positionScreen.y),n.isLineBasicMaterial){if(m(n.linewidth),u(n.linecap),E(n.linejoin),n.vertexColors!==THREE.VertexColors)x(n.color.getStyle());else{var r=i.vertexColors[0].getStyle(),o=i.vertexColors[1].getStyle();if(r===o)x(r);else{try{var a=Z.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,r),a.addColorStop(1,o)}catch(e){a=r}x(a)}}Z.stroke(),ue.expandByScalar(2*n.linewidth)}else n.isLineDashedMaterial&&(m(n.linewidth),u(n.linecap),E(n.linejoin),x(n.color.getStyle()),v([n.dashSize,n.gapSize]),Z.stroke(),ue.expandByScalar(2*n.linewidth),v([]))}function o(e,t,n,r,o,c,d,m){if(N.info.render.vertices+=3,N.info.render.faces++,f(m.opacity),h(m.blending),C=e.positionScreen.x,H=e.positionScreen.y,b=t.positionScreen.x,L=t.positionScreen.y,B=n.positionScreen.x,P=n.positionScreen.y,a(C,H,b,L,B,P),(m.isMeshLambertMaterial||m.isMeshPhongMaterial||m.isMeshStandardMaterial)&&null===m.map)ce.copy(m.color),pe.copy(m.emissive),m.vertexColors===THREE.FaceColors&&ce.multiply(d.color),le.copy(Ee),ge.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),i(ge,d.normalModel,le),le.multiply(ce).add(pe),!0===m.wireframe?s(le,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):l(le);else if(m.isMeshBasicMaterial||m.isMeshLambertMaterial||m.isMeshPhongMaterial||m.isMeshStandardMaterial)if(null!==m.map){var u=m.map.mapping;u===THREE.UVMapping&&(z=d.uvs,p(C,H,b,L,B,P,z[r].x,z[r].y,z[o].x,z[o].y,z[c].x,z[c].y,m.map))}else null!==m.envMap?m.envMap.mapping===THREE.SphericalReflectionMapping&&(Se.copy(d.vertexNormalsModel[r]).applyMatrix3(Re),W=.5*Se.x+.5,j=.5*Se.y+.5,Se.copy(d.vertexNormalsModel[o]).applyMatrix3(Re),V=.5*Se.x+.5,k=.5*Se.y+.5,Se.copy(d.vertexNormalsModel[c]).applyMatrix3(Re),D=.5*Se.x+.5,F=.5*Se.y+.5,p(C,H,b,L,B,P,W,j,V,k,D,F,m.envMap)):(le.copy(m.color),m.vertexColors===THREE.FaceColors&&le.multiply(d.color),!0===m.wireframe?s(le,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):l(le));else m.isMeshNormalMaterial?(Se.copy(d.normalModel).applyMatrix3(Re),le.setRGB(Se.x,Se.y,Se.z).multiplyScalar(.5).addScalar(.5),!0===m.wireframe?s(le,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):l(le)):(le.setRGB(1,1,1),!0===m.wireframe?s(le,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):l(le))}function a(e,t,i,n,r,o){Z.beginPath(),Z.moveTo(e,t),Z.lineTo(i,n),Z.lineTo(r,o),Z.closePath()}function s(e,t,i,n){m(t),u(i),E(n),x(e.getStyle()),Z.stroke(),ue.expandByScalar(2*t)}function l(e){y(e.getStyle()),Z.fill()}function c(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:undefined,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:undefined,version:0};var i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,n=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,r=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(r?2:1),a.height=t.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0===r&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0===o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0===r&&!0===o&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";!0===i&&!0===n?l="repeat":!0===i?l="repeat-x":!0===n&&(l="repeat-y");var c=Z.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function p(e,t,i,n,r,o,a,s,l,p,d,f,h){var m=fe[h.id];if(m!==undefined&&m.version===h.version||(m=c(h),fe[h.id]=m),m.canvas===undefined)return y("rgba( 0, 0, 0, 1)"),void Z.fill();y(m.canvas);var u,E,x,v,g,S,R,T,w=h.offset.x/h.repeat.x,M=h.offset.y/h.repeat.y,C=h.image.width*h.repeat.x,H=h.image.height*h.repeat.y;a=(a+w)*C,s=(s+M)*H,l=(l+w)*C,p=(p+M)*H,d=(d+w)*C,f=(f+M)*H,i-=e,n-=t,r-=e,o-=t,l-=a,p-=s,d-=a,f-=s,0!==(R=l*f-d*p)&&(T=1/R,u=(f*i-p*r)*T,E=(f*n-p*o)*T,x=(l*r-d*i)*T,v=(l*o-d*n)*T,g=e-u*a-x*s,S=t-E*a-v*s,Z.save(),Z.transform(u,E,x,v,g,S),Z.fill(),Z.restore())}function d(e,t,i){var n,r=t.x-e.x,o=t.y-e.y,a=r*r+o*o;0!==a&&(n=i/Math.sqrt(a),r*=n,o*=n,t.x+=r,t.y+=o,e.x-=r,e.y-=o)}function f(e){ee!==e&&(Z.globalAlpha=e,ee=e)}function h(e){te!==e&&(e===THREE.NormalBlending?Z.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?Z.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?Z.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(Z.globalCompositeOperation="multiply"),te=e)}function m(e){re!==e&&(Z.lineWidth=e,re=e)}function u(e){oe!==e&&(Z.lineCap=e,oe=e)}function E(e){ae!==e&&(Z.lineJoin=e,ae=e)}function x(e){ie!==e&&(Z.strokeStyle=e,ie=e)}function y(e){ne!==e&&(Z.fillStyle=e,ne=e)}function v(e){se.length!==e.length&&(Z.setLineDash(e),se=e)}console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var g,S,R,T,w,M,C,H,b,L,B,P,z,W,j,V,k,D,F,N=this,O=new THREE.Projector,A=e.canvas!==undefined?e.canvas:document.createElement("canvas"),I=A.width,G=A.height,U=Math.floor(I/2),q=Math.floor(G/2),J=0,K=0,Q=I,X=G,Y=1,Z=A.getContext("2d",{alpha:!0===e.alpha}),$=new THREE.Color(0),_=!0===e.alpha?0:1,ee=1,te=0,ie=null,ne=null,re=null,oe=null,ae=null,se=[],le=new THREE.Color,ce=new THREE.Color,pe=new THREE.Color,de=new THREE.Color,fe={},he=new THREE.Box2,me=new THREE.Box2,ue=new THREE.Box2,Ee=new THREE.Color,xe=new THREE.Color,ye=new THREE.Color,ve=new THREE.Vector3,ge=new THREE.Vector3,Se=new THREE.Vector3,Re=new THREE.Matrix3;Z.setLineDash===undefined&&(Z.setLineDash=function(){}),this.domElement=A,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){e!==undefined&&(Y=e)},this.setSize=function(e,t,i){I=e*Y,G=t*Y,A.width=I,A.height=G,U=Math.floor(I/2),q=Math.floor(G/2),!1!==i&&(A.style.width=e+"px",A.style.height=t+"px"),he.min.set(-U,-q),he.max.set(U,q),me.min.set(-U,-q),me.max.set(U,q),ee=1,te=0,ie=null,ne=null,re=null,oe=null,ae=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){J=e*Y,K=t*Y,Q=i*Y,X=n*Y},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){$.set(e),_=t!==undefined?t:1,me.min.set(-U,-q),me.max.set(U,q)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return $},this.getClearAlpha=function(){return _},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===me.isEmpty()&&(me.intersect(he),me.expandByScalar(2),me.min.x=me.min.x+U,me.min.y=-me.min.y+q,me.max.x=me.max.x+U,me.max.y=-me.max.y+q,_<1&&Z.clearRect(0|me.min.x,0|me.max.y,me.max.x-me.min.x|0,me.min.y-me.max.y|0),_>0&&(h(THREE.NormalBlending),f(1),y("rgba("+Math.floor(255*$.r)+","+Math.floor(255*$.g)+","+Math.floor(255*$.b)+","+_+")"),Z.fillRect(0|me.min.x,0|me.max.y,me.max.x-me.min.x|0,me.min.y-me.max.y|0)),me.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,i){if(i.isCamera===undefined)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");var a=e.background;a&&a.isColor?(y("rgb("+Math.floor(255*a.r)+","+Math.floor(255*a.g)+","+Math.floor(255*a.b)+")"),Z.fillRect(0,0,I,G)):!0===this.autoClear&&this.clear(),N.info.render.vertices=0,N.info.render.faces=0,Z.setTransform(Q/I,0,0,-X/G,J,G-K),Z.translate(U,q),g=O.projectScene(e,i,this.sortObjects,this.sortElements),S=g.elements,R=g.lights,Re.getNormalMatrix(i.matrixWorldInverse),t();for(var s=0,l=S.length;s<l;s++){var c=S[s],p=c.material;if(p!==undefined&&0!==p.opacity){if(ue.makeEmpty(),c instanceof THREE.RenderableSprite)T=c,T.x*=U,T.y*=q,n(T,c,p);else if(c instanceof THREE.RenderableLine)T=c.v1,w=c.v2,T.positionScreen.x*=U,T.positionScreen.y*=q,w.positionScreen.x*=U,w.positionScreen.y*=q,ue.setFromPoints([T.positionScreen,w.positionScreen]),!0===he.intersectsBox(ue)&&r(T,w,c,p);else if(c instanceof THREE.RenderableFace){if(T=c.v1,w=c.v2,M=c.v3,T.positionScreen.z<-1||T.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;if(M.positionScreen.z<-1||M.positionScreen.z>1)continue;T.positionScreen.x*=U,T.positionScreen.y*=q,w.positionScreen.x*=U,w.positionScreen.y*=q,M.positionScreen.x*=U,M.positionScreen.y*=q,p.overdraw>0&&(d(T.positionScreen,w.positionScreen,p.overdraw),d(w.positionScreen,M.positionScreen,p.overdraw),d(M.positionScreen,T.positionScreen,p.overdraw)),ue.setFromPoints([T.positionScreen,w.positionScreen,M.positionScreen]),!0===he.intersectsBox(ue)&&o(T,w,M,0,1,2,c,p)}me.union(ue)}}Z.setTransform(1,0,0,1,0,0)}};